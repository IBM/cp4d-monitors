{
    "componentChunkName": "component---src-pages-monitors-cp-4-d-wml-deployment-space-job-info-manual-index-mdx",
    "path": "/monitors/cp4d-wml-deployment-space-job-info/manual/",
    "result": {"pageContext":{"frontmatter":{"title":"Manual Deployment of Watson Machine Learning Deployment Space Job Information"},"relativePagePath":"/monitors/cp4d-wml-deployment-space-job-info/manual/index.mdx","titleType":"page","MdxNode":{"id":"8555be23-174c-5ab6-a2a4-f06afaccafd2","children":[],"parent":"41ca0e4d-2966-52fa-94c2-54b6ee4c5c4a","internal":{"content":"---\ntitle: Manual Deployment of Watson Machine Learning Deployment Space Job Information\n---\n\nThis page will go through all manual steps to deploy the Watson Machine Learning Deployment Space Job Information monitor, and in addition to delete it. \n\nThe following pre-requisites are assumed:\n- IBM Cloud Pak for Data is successfully deployed\n- (Optional) Prometheus is configured. Refer to [setup OpenShift Prometheus and Cloud Pak for Data ServiceMonitor](../setup-openshift-prometheus/configure_prometheus.md) for instructions\n\nThis manual deployment will be based on:\n- Source of the Monitor is located in a Git Repository\n- The Image will be pushed to the internal OpenShift Image Registry \n\n## Deploy Watson Machine Learning Deployment Space Job Information\n\n### Create Source Repository authorization secret\n\nCreate a secret to access the Git Source repository **only** when it does not exist in ${CP4D_PROJECT} namespace. \n\nPlease check if the secret exists in ${CP4D_PROJECT} namespace using the following command:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\n\noc get secret -n ${CP4D_PROJECT}  |grep monitor-repo-auth |wc -l\n```\n\nIf the result is `0`, please run the commands below to create Git Source repository authorization secret. If not, please skip the step, monitor will reuse the secret monitor-repo-auth. \n\n```\nexport GIT_SOURCE_TOKEN=<GIT_TOKEN>\nexport CP4D_PROJECT=<CP4D_PROJECT>\n\ncat << EOF | oc apply -f -\napiVersion: v1\nstringData:\n  password: ${GIT_SOURCE_TOKEN}\nkind: Secret\nmetadata:\n  name: monitor-repo-auth\n  namespace: ${CP4D_PROJECT}\ntype: kubernetes.io/basic-auth\nEOF\n```\n\n### Build the Monitor Image and push to the registry\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport OPENSHIFT_IMAGE_REGISTRY=image-registry.openshift-image-registry.svc:5000/${CP4D_PROJECT}\nexport GIT_SOURCE_TOKEN=<GIT_TOKEN>\n\noc new-build https://iamapikey:${GIT_SOURCE_TOKEN}@github.com/IBM/cp4d-monitors \\\n --context-dir cp4d-wml-deployment-space-job-info  \\\n --name cp4d-platform-wml-deployment-space-job-info \\\n --source-secret monitor-repo-auth \\\n --to ${OPENSHIFT_IMAGE_REGISTRY}/cp4d-platform-wml-deployment-space-job-info:latest \\\n --to-docker=true \\\n --namespace ${CP4D_PROJECT}\n```\n\nWait for the build to complete successfully\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc wait -n ${CP4D_PROJECT} --for=condition=Complete build/cp4d-platform-wml-deployment-space-job-info-1  --timeout=300s\n```\nor to monitor the build process:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc logs -n ${CP4D_PROJECT} build/cp4d-platform-wml-deployment-space-job-info-1 -f\n```\nEnsure the build finishes with the message `Push successful`\n\n### Create the Cloud Pak for Data zen-watchdog monitor configuration\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport OPENSHIFT_IMAGE_REGISTRY=image-registry.openshift-image-registry.svc:5000/${CP4D_PROJECT}\n\ncat << EOF | oc apply -f -\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension\n  labels:\n    app: zen-adv\n    icpdata_addon: 'true'\n    icpdata_addon_version: 4.3.0\n    release: zen-adv\ndata:\n  extensions: |\n    [\n      {\n        \"extension_point_id\": \"zen_alert_monitor\",\n        \"extension_name\": \"zen_alert_cp4d_platform_wml_deployment_space_job_info\",\n        \"display_name\": \"Watson Machine Learning Deployment Space Job Info\",\n        \"details\": {\n          \"name\": \"cp4d-platform-wml-deployment-space-job-info\",\n          \"image\": \"${OPENSHIFT_IMAGE_REGISTRY}/cp4d-platform-wml-deployment-space-job-info:latest\",\n          \"schedule\": \"*/15 * * * *\",\n          \"event_types\": [\n            {\n              \"name\": \"cp4d_wml_deployment_space_jobs_overall_count\",\n              \"simple_name\": \"Watson Machine Learning Deployment Space Jobs Info Overall Count\",\n              \"alert_type\": \"platform\",\n              \"short_description\": \"CP4D Watson Machine Learning Deployment Space Info Overall Count\",\n              \"long_description\": \"CP4D Watson Mechine Learning Deployment Space Info Overall Count: <cp4d_wml_deployment_space_jobs_overall_count>\",                \n              \"resolution\": \"none\",\n              \"reason_code_prefix\": \"80\"\n            },              \n            {\n              \"name\": \"cp4d_wml_deployment_space_jobs_active_count\",\n              \"simple_name\": \"Watson Mechine Learning Deployment Space Acitve Job Count\",\n              \"alert_type\": \"platform\",\n              \"short_description\": \"CP4D Watson Mechine Learning Deployment Space Acitve Job Count\",\n              \"long_description\": \"CP4D Watson Mechine Learning Deployment Space Active Job Count: <cp4d_wml_deployment_space_jobs_active_count>\",\n              \"resolution\": \"none\",\n              \"reason_code_prefix\": \"80\"\n            },\n            {\n              \"name\": \"cp4d_wml_deployment_space_job_last_status\",\n              \"simple_name\": \"Last status of Watson Mechine Learning Deployment Space Job\",\n              \"alert_type\": \"platform\",\n              \"short_description\": \"Last status of CP4D Watson Mechine Learning Deployment Space Job\",\n              \"long_description\": \"Last status of CP4D Watson Mechine Learning Deployment Space Job: <cp4d_wml_deployment_space_job_last_status>\",                \n              \"resolution\": \"none\",\n              \"reason_code_prefix\": \"80\"\n            }       \n          ]\n        }\n      }\n    ]\nEOF\n```\n**Note:** Once the ConfigMap above is created, the zen-watcher pod will detect it. Please check the log of zen-watcher pod for details. For example:\n```\n\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport ZEN_WATCHER_POD=$(oc get po -l component=zen-watcher -o custom-columns=CONTAINER:.metadata.name --no-headers)\noc logs ${ZEN_WATCHER_POD}\n\ntime=\"2022-05-31 05:25:59\" level=info msg=processConfigData event=\"adding extensions from zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension to the database\"\ntime=\"2022-05-31 05:25:59\" level=info msg=CleanUpStaleExtensions event=\"upgrade extensions: removing stale extensions from zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension to the database\"\ntime=\"2022-05-31 05:25:59\" level=info msg=processExtensionHandler event=\"processing action: update for extension\" extension_name=zen_alert_cp4d_platform_wml_deployment_space_job_info\ntime=\"2022-05-31 05:25:59\" level=info msg=watchConfigMap event=\"config zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension added\"\n```\n\n### Wait for zen-watchdog to create cronjob\n\nGet the watchdog-alert-monitoring-cronjob cronjob details of Cloud Pak for Data\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\n\noc get cronjob watchdog-alert-monitoring-cronjob -n ${CP4D_PROJECT}\n\nNAME                                SCHEDULE       SUSPEND   ACTIVE   LAST SCHEDULE   AGE\nwatchdog-alert-monitoring-cronjob   */10 * * * *   False     0        3m46s           7d3h\n```\nThis cronjob must run in order for the Watson Studio Job cronjob to be created. Optionally the schedule can be changed to trigger its execution. The pod zen-watchdog can be monitored for any error messages:\n```\n\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport ZEN_WATCHDOG_POD=$(oc get po -n ${CP4D_PROJECT} -l component=zen-watchdog -o custom-columns=CONTAINER:.metadata.name --no-headers)\n\noc logs -n ${CP4D_PROJECT} ${ZEN_WATCHDOG_POD} -f\n```\n\nThe new monitor cronjob is created:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc get cronjob -n ${CP4D_PROJECT}\n\nNAME                                                  SCHEDULE       SUSPEND   ACTIVE   LAST SCHEDULE   AGE\ncp4d-platform-wml-deployment-space-job-info-cronjob   */15 * * * *   False     0        <none>          3s\n```\n\nMost monitors require access to the Cloud Pak for Data /user-home folder to cache information. To test whether this mount point is already present on the monitor use the following command:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport CP4D_CRONJOB=cp4d-platform-wml-deployment-space-job-info-cronjob\noc set volume -n ${CP4D_PROJECT} cronjobs/${CP4D_CRONJOB} | grep \"mounted at /user-home\" | wc -l\n```\nIf the result is `0`, patch the cronjob using the following command:\n```\noc patch cronjob -n ${CP4D_PROJECT} ${CP4D_CRONJOB} \\\n--type=json \\\n--patch '[{\"op\": \"add\",\"path\": \"/spec/jobTemplate/spec/template/spec/containers/0/volumeMounts/-\",\"value\": {\"name\": \"user-home-mount\",\"mountPath\": \"/user-home\"}}]'\n```\n\n\nBased on the schedule the cronjob will be executed. This will create a pod, which can be monitored:\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc logs -n ${CP4D_PROJECT} <PODNAME>\n```\n\n## Rebuilding the image\nWhen changes are applied to the monitor, restarting the Build Config will re-build and push the image to the image registry. No other changed are required. The next time the cronjob is executed, the new version of the monitor image will be used\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport CP4D_CRONJOB=cp4d-platform-wml-deployment-space-job-info-cronjob\n\noc start-build -n ${CP4D_PROJECT} cp4d-platform-wml-deployment-space-job-info                                  \n```\nMonitor the build using (use -2, -3 etc, based on the created build by the previous command):\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc logs -n ${CP4D_PROJECT} build/cp4d-platform-wml-deployment-space-job-info-2 -f\n```\nPatch the cronjob so it will Always pull the image to ensure it will fetch the latest version once triggered\n```\noc patch cronjob -n ${CP4D_PROJECT} ${CP4D_CRONJOB} \\\n  --type=json \\\n  --patch '[{\"op\":\"replace\",\"path\":\"/spec/jobTemplate/spec/template/spec/containers/0/imagePullPolicy\",\"value\":\"Always\"}]'\n```\n\n## Remove the Monitor\n\nUse the following commands to delete the monitor\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport CP4D_CRONJOB=cp4d-platform-wml-deployment-space-job-info-cronjob\noc delete bc -n ${CP4D_PROJECT} cp4d-platform-wml-deployment-space-job-info\noc delete cm -n ${CP4D_PROJECT} zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension \noc delete secret -n ${CP4D_PROJECT} monitor-repo-auth \noc delete cronjob -n ${CP4D_PROJECT} ${CP4D_CRONJOB} \noc delete cm -n ${CP4D_PROJECT} cp4d-monitor-configuration\n```\n**Note:** Please only delete the configmap cp4d-monitor-configuration if no other monitors are deployed. The configmap cp4d-monitor-configuration is generated by monitor. When monitor is deployed and scheduled to run, it will create the configmap with its default values.\n\n```\n\"cp4d-job-last-refresh\" : \"0\"\n\"cp4d-job-refresh-interval-minutes\": \"120\"\n\"cp4d-project-last-refresh\": \"0\"\n\"cp4d-project-refresh-interval-minutes\": \"240\"\n\"cp4d-space-last-refresh\": \"0\"\n\"cp4d-space-refresh-interval-minutes\": \"120\"\n\"cp4d-wkc-last-refresh\": \"0\"\n\"cp4d-wkc-refresh-interval-minutes\": \"120\"\n```\n\n## Reset Cloud Pak for Data metrics configuration and influxdb\nIf, during development, the zen-watchdog is unable to process events because of an incorrect configuration or naming convention, using the following steps to reset the zen-watchdog and its influxdb\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc project ${CP4D_PROJECT}\n\noc exec -it zen-metastoredb-0 /bin/bash\ncp -r /certs/ /tmp/\ncd /tmp/ && chmod -R 0700 certs/\ncd /cockroach \n./cockroach sql --certs-dir=/tmp/certs/ --host=zen-metastoredb-0.zen-metastoredb\nuse zen;\ndrop table policies;\ndrop table products;\ndrop table monitors;\ndrop table monitor_events;\ndrop table event_types;\nexit\n\noc delete cronjob watchdog-alert-monitoring-cronjob watchdog-alert-monitoring-purge-cronjob zen-watchdog-cronjob diagnostics-cronjob\noc delete pod -l component=zen-watchdog\n```\nWait for the cronjobs to be re-created\n\nAcquire the Password for influxdb, and copy it.\n```\noc extract secret/dsx-influxdb-auth --keys=influxdb-password --to=-\n```\n\nDelete the influxdb entries\n```\noc exec -it dsx-influxdb-0 bash\ninflux -ssl -unsafeSsl\nauth\n<enter>admin\n\nDelete the events\n\nuse WATCHDOG;\ndrop measurement events;\n```","type":"Mdx","contentDigest":"94c7cf4b195763cdd2a2cd93b0138a5b","owner":"gatsby-plugin-mdx","counter":154},"frontmatter":{"title":"Manual Deployment of Watson Machine Learning Deployment Space Job Information"},"exports":{},"rawBody":"---\ntitle: Manual Deployment of Watson Machine Learning Deployment Space Job Information\n---\n\nThis page will go through all manual steps to deploy the Watson Machine Learning Deployment Space Job Information monitor, and in addition to delete it. \n\nThe following pre-requisites are assumed:\n- IBM Cloud Pak for Data is successfully deployed\n- (Optional) Prometheus is configured. Refer to [setup OpenShift Prometheus and Cloud Pak for Data ServiceMonitor](../setup-openshift-prometheus/configure_prometheus.md) for instructions\n\nThis manual deployment will be based on:\n- Source of the Monitor is located in a Git Repository\n- The Image will be pushed to the internal OpenShift Image Registry \n\n## Deploy Watson Machine Learning Deployment Space Job Information\n\n### Create Source Repository authorization secret\n\nCreate a secret to access the Git Source repository **only** when it does not exist in ${CP4D_PROJECT} namespace. \n\nPlease check if the secret exists in ${CP4D_PROJECT} namespace using the following command:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\n\noc get secret -n ${CP4D_PROJECT}  |grep monitor-repo-auth |wc -l\n```\n\nIf the result is `0`, please run the commands below to create Git Source repository authorization secret. If not, please skip the step, monitor will reuse the secret monitor-repo-auth. \n\n```\nexport GIT_SOURCE_TOKEN=<GIT_TOKEN>\nexport CP4D_PROJECT=<CP4D_PROJECT>\n\ncat << EOF | oc apply -f -\napiVersion: v1\nstringData:\n  password: ${GIT_SOURCE_TOKEN}\nkind: Secret\nmetadata:\n  name: monitor-repo-auth\n  namespace: ${CP4D_PROJECT}\ntype: kubernetes.io/basic-auth\nEOF\n```\n\n### Build the Monitor Image and push to the registry\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport OPENSHIFT_IMAGE_REGISTRY=image-registry.openshift-image-registry.svc:5000/${CP4D_PROJECT}\nexport GIT_SOURCE_TOKEN=<GIT_TOKEN>\n\noc new-build https://iamapikey:${GIT_SOURCE_TOKEN}@github.com/IBM/cp4d-monitors \\\n --context-dir cp4d-wml-deployment-space-job-info  \\\n --name cp4d-platform-wml-deployment-space-job-info \\\n --source-secret monitor-repo-auth \\\n --to ${OPENSHIFT_IMAGE_REGISTRY}/cp4d-platform-wml-deployment-space-job-info:latest \\\n --to-docker=true \\\n --namespace ${CP4D_PROJECT}\n```\n\nWait for the build to complete successfully\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc wait -n ${CP4D_PROJECT} --for=condition=Complete build/cp4d-platform-wml-deployment-space-job-info-1  --timeout=300s\n```\nor to monitor the build process:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc logs -n ${CP4D_PROJECT} build/cp4d-platform-wml-deployment-space-job-info-1 -f\n```\nEnsure the build finishes with the message `Push successful`\n\n### Create the Cloud Pak for Data zen-watchdog monitor configuration\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport OPENSHIFT_IMAGE_REGISTRY=image-registry.openshift-image-registry.svc:5000/${CP4D_PROJECT}\n\ncat << EOF | oc apply -f -\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension\n  labels:\n    app: zen-adv\n    icpdata_addon: 'true'\n    icpdata_addon_version: 4.3.0\n    release: zen-adv\ndata:\n  extensions: |\n    [\n      {\n        \"extension_point_id\": \"zen_alert_monitor\",\n        \"extension_name\": \"zen_alert_cp4d_platform_wml_deployment_space_job_info\",\n        \"display_name\": \"Watson Machine Learning Deployment Space Job Info\",\n        \"details\": {\n          \"name\": \"cp4d-platform-wml-deployment-space-job-info\",\n          \"image\": \"${OPENSHIFT_IMAGE_REGISTRY}/cp4d-platform-wml-deployment-space-job-info:latest\",\n          \"schedule\": \"*/15 * * * *\",\n          \"event_types\": [\n            {\n              \"name\": \"cp4d_wml_deployment_space_jobs_overall_count\",\n              \"simple_name\": \"Watson Machine Learning Deployment Space Jobs Info Overall Count\",\n              \"alert_type\": \"platform\",\n              \"short_description\": \"CP4D Watson Machine Learning Deployment Space Info Overall Count\",\n              \"long_description\": \"CP4D Watson Mechine Learning Deployment Space Info Overall Count: <cp4d_wml_deployment_space_jobs_overall_count>\",                \n              \"resolution\": \"none\",\n              \"reason_code_prefix\": \"80\"\n            },              \n            {\n              \"name\": \"cp4d_wml_deployment_space_jobs_active_count\",\n              \"simple_name\": \"Watson Mechine Learning Deployment Space Acitve Job Count\",\n              \"alert_type\": \"platform\",\n              \"short_description\": \"CP4D Watson Mechine Learning Deployment Space Acitve Job Count\",\n              \"long_description\": \"CP4D Watson Mechine Learning Deployment Space Active Job Count: <cp4d_wml_deployment_space_jobs_active_count>\",\n              \"resolution\": \"none\",\n              \"reason_code_prefix\": \"80\"\n            },\n            {\n              \"name\": \"cp4d_wml_deployment_space_job_last_status\",\n              \"simple_name\": \"Last status of Watson Mechine Learning Deployment Space Job\",\n              \"alert_type\": \"platform\",\n              \"short_description\": \"Last status of CP4D Watson Mechine Learning Deployment Space Job\",\n              \"long_description\": \"Last status of CP4D Watson Mechine Learning Deployment Space Job: <cp4d_wml_deployment_space_job_last_status>\",                \n              \"resolution\": \"none\",\n              \"reason_code_prefix\": \"80\"\n            }       \n          ]\n        }\n      }\n    ]\nEOF\n```\n**Note:** Once the ConfigMap above is created, the zen-watcher pod will detect it. Please check the log of zen-watcher pod for details. For example:\n```\n\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport ZEN_WATCHER_POD=$(oc get po -l component=zen-watcher -o custom-columns=CONTAINER:.metadata.name --no-headers)\noc logs ${ZEN_WATCHER_POD}\n\ntime=\"2022-05-31 05:25:59\" level=info msg=processConfigData event=\"adding extensions from zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension to the database\"\ntime=\"2022-05-31 05:25:59\" level=info msg=CleanUpStaleExtensions event=\"upgrade extensions: removing stale extensions from zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension to the database\"\ntime=\"2022-05-31 05:25:59\" level=info msg=processExtensionHandler event=\"processing action: update for extension\" extension_name=zen_alert_cp4d_platform_wml_deployment_space_job_info\ntime=\"2022-05-31 05:25:59\" level=info msg=watchConfigMap event=\"config zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension added\"\n```\n\n### Wait for zen-watchdog to create cronjob\n\nGet the watchdog-alert-monitoring-cronjob cronjob details of Cloud Pak for Data\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\n\noc get cronjob watchdog-alert-monitoring-cronjob -n ${CP4D_PROJECT}\n\nNAME                                SCHEDULE       SUSPEND   ACTIVE   LAST SCHEDULE   AGE\nwatchdog-alert-monitoring-cronjob   */10 * * * *   False     0        3m46s           7d3h\n```\nThis cronjob must run in order for the Watson Studio Job cronjob to be created. Optionally the schedule can be changed to trigger its execution. The pod zen-watchdog can be monitored for any error messages:\n```\n\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport ZEN_WATCHDOG_POD=$(oc get po -n ${CP4D_PROJECT} -l component=zen-watchdog -o custom-columns=CONTAINER:.metadata.name --no-headers)\n\noc logs -n ${CP4D_PROJECT} ${ZEN_WATCHDOG_POD} -f\n```\n\nThe new monitor cronjob is created:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc get cronjob -n ${CP4D_PROJECT}\n\nNAME                                                  SCHEDULE       SUSPEND   ACTIVE   LAST SCHEDULE   AGE\ncp4d-platform-wml-deployment-space-job-info-cronjob   */15 * * * *   False     0        <none>          3s\n```\n\nMost monitors require access to the Cloud Pak for Data /user-home folder to cache information. To test whether this mount point is already present on the monitor use the following command:\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport CP4D_CRONJOB=cp4d-platform-wml-deployment-space-job-info-cronjob\noc set volume -n ${CP4D_PROJECT} cronjobs/${CP4D_CRONJOB} | grep \"mounted at /user-home\" | wc -l\n```\nIf the result is `0`, patch the cronjob using the following command:\n```\noc patch cronjob -n ${CP4D_PROJECT} ${CP4D_CRONJOB} \\\n--type=json \\\n--patch '[{\"op\": \"add\",\"path\": \"/spec/jobTemplate/spec/template/spec/containers/0/volumeMounts/-\",\"value\": {\"name\": \"user-home-mount\",\"mountPath\": \"/user-home\"}}]'\n```\n\n\nBased on the schedule the cronjob will be executed. This will create a pod, which can be monitored:\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc logs -n ${CP4D_PROJECT} <PODNAME>\n```\n\n## Rebuilding the image\nWhen changes are applied to the monitor, restarting the Build Config will re-build and push the image to the image registry. No other changed are required. The next time the cronjob is executed, the new version of the monitor image will be used\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport CP4D_CRONJOB=cp4d-platform-wml-deployment-space-job-info-cronjob\n\noc start-build -n ${CP4D_PROJECT} cp4d-platform-wml-deployment-space-job-info                                  \n```\nMonitor the build using (use -2, -3 etc, based on the created build by the previous command):\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc logs -n ${CP4D_PROJECT} build/cp4d-platform-wml-deployment-space-job-info-2 -f\n```\nPatch the cronjob so it will Always pull the image to ensure it will fetch the latest version once triggered\n```\noc patch cronjob -n ${CP4D_PROJECT} ${CP4D_CRONJOB} \\\n  --type=json \\\n  --patch '[{\"op\":\"replace\",\"path\":\"/spec/jobTemplate/spec/template/spec/containers/0/imagePullPolicy\",\"value\":\"Always\"}]'\n```\n\n## Remove the Monitor\n\nUse the following commands to delete the monitor\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\nexport CP4D_CRONJOB=cp4d-platform-wml-deployment-space-job-info-cronjob\noc delete bc -n ${CP4D_PROJECT} cp4d-platform-wml-deployment-space-job-info\noc delete cm -n ${CP4D_PROJECT} zen-alert-cp4d-platform-wml-deployment-space-job-info-monitor-extension \noc delete secret -n ${CP4D_PROJECT} monitor-repo-auth \noc delete cronjob -n ${CP4D_PROJECT} ${CP4D_CRONJOB} \noc delete cm -n ${CP4D_PROJECT} cp4d-monitor-configuration\n```\n**Note:** Please only delete the configmap cp4d-monitor-configuration if no other monitors are deployed. The configmap cp4d-monitor-configuration is generated by monitor. When monitor is deployed and scheduled to run, it will create the configmap with its default values.\n\n```\n\"cp4d-job-last-refresh\" : \"0\"\n\"cp4d-job-refresh-interval-minutes\": \"120\"\n\"cp4d-project-last-refresh\": \"0\"\n\"cp4d-project-refresh-interval-minutes\": \"240\"\n\"cp4d-space-last-refresh\": \"0\"\n\"cp4d-space-refresh-interval-minutes\": \"120\"\n\"cp4d-wkc-last-refresh\": \"0\"\n\"cp4d-wkc-refresh-interval-minutes\": \"120\"\n```\n\n## Reset Cloud Pak for Data metrics configuration and influxdb\nIf, during development, the zen-watchdog is unable to process events because of an incorrect configuration or naming convention, using the following steps to reset the zen-watchdog and its influxdb\n\n```\nexport CP4D_PROJECT=<CP4D_PROJECT>\noc project ${CP4D_PROJECT}\n\noc exec -it zen-metastoredb-0 /bin/bash\ncp -r /certs/ /tmp/\ncd /tmp/ && chmod -R 0700 certs/\ncd /cockroach \n./cockroach sql --certs-dir=/tmp/certs/ --host=zen-metastoredb-0.zen-metastoredb\nuse zen;\ndrop table policies;\ndrop table products;\ndrop table monitors;\ndrop table monitor_events;\ndrop table event_types;\nexit\n\noc delete cronjob watchdog-alert-monitoring-cronjob watchdog-alert-monitoring-purge-cronjob zen-watchdog-cronjob diagnostics-cronjob\noc delete pod -l component=zen-watchdog\n```\nWait for the cronjobs to be re-created\n\nAcquire the Password for influxdb, and copy it.\n```\noc extract secret/dsx-influxdb-auth --keys=influxdb-password --to=-\n```\n\nDelete the influxdb entries\n```\noc exec -it dsx-influxdb-0 bash\ninflux -ssl -unsafeSsl\nauth\n<enter>admin\n\nDelete the events\n\nuse WATCHDOG;\ndrop measurement events;\n```","fileAbsolutePath":"/root/yefei/cp4d-monitors/doc/src/pages/monitors/cp4d-wml-deployment-space-job-info/manual/index.mdx"}}},
    "staticQueryHashes": ["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}